<!--
 * @Author: Connor
 * @Date: 2022-11-11 14:15:32
 * @LastEditors: Connor
 * @LastEditTime: 2022-11-11 15:05:58
 * @FilePath: \碧林威生产测试文件\NB-IoT_PSM\NB-IoT_PSM.md
 * @Description: 
 * 
 * Copyright (c) 2022 by Connor/BLW, All Rights Reserved. 
-->
#前言
## psm工作机制
```
psm设备除了上报消息的间隙之外，长时间处于断网状态。
如平台下发命令，命令将暂存于电信NB-IoT平台，
设备上报消息时，会主动唤醒自身，并和平台建立联系，此时平台会将此前已缓存的命令，下发至设备。
```
# 界面视图
## app操作界面
<div align="center">
<img src=./docs/app.jpg width=30% />
</div>
### 开关机制
```
pms模式种的开关，只作为上报属性，app将不再可以下发开关指令至路灯。
```
### rtc激活情况
```
rtc最大支持10任务，任务id与网页创建任务的顺序相关。
```
### 亮度值
```
亮度值可直接下发，下发后指令会缓存于电信NB-IoT服务器，待设备上报消息时，接受此缓存指令，
此处下发数据，决定设备每次上电后的默认亮度，
当rtc任务中有亮度调整指令时，会将新调整的亮度作为消息上报。
```
### 参数显示栏目
此处不作过多说明，设备在上电后，会在三种情况下上报信息。
```
一、每次收到消息后6秒，如6秒内再次收到消息，则继续延后6秒。
二、在亮度、开关状态产生变化后6秒，此变化可以由rtc任务引起，也可以是由下发亮度指令引起。
三、设备上电，度过错峰驻网时间后，先上报一次消息，之后每间隔 “上报时间间隔” 所设定时间后，上报一次消息。
```
设备上报消息内容包含以下两种。
```
一、路灯开启时，此时所上报消息包括，开关状态、亮度、工作功率、总耗电量、总开灯时间、功率因数、电压有效值、电流有效值、故障代码、额定功率、上电默认开关状态、RTC激活状态、错峰驻网设定时间、上报时间间隔。
二、路灯关闭时，此时所上报消息包括、开关状态、亮度、总耗电量、总工作时间、故障代码、额定功率、上电默认开关状态、RTC激活状态、错峰驻网设定时间、上报时间间隔。
```
### 上电默认开关状态
```
此设定将决定设备每次上电之后的初始开关状态。
```
### 错峰驻网设定
```
设备上电后，将在此设定时间后，开启NB-IoT模组，进行设备驻网。
设定范围为0~900秒，即0~15分钟。
```
### 额定功率设定
```
设备将依照此参数，于实时工作亮度、电流、电压、功率进行对比，如差额过大，则判定为功率、电流、电压异常。
当此项设定为0时，设备将不在进行比对，只以 30%亮度以上，功率需大于20w进行故障判定。
```
## web端rtc设置界面
### 创建RTC任务
<div align="center">
<img src=./docs/web_create.png width=60% />
</div>
```
页面会依创建任务的次序，判定任务的id。
右侧按钮激活时，点击按钮，将下发“此项rtc任务禁止” 指令。
点击按钮失能时，点击按钮，则下发“此项rtc任务激活” 指令。
```
### 设定RTC任务
<div align="center">
<img src=./docs/web_select.png width=60% />
</div>
定时选项
```
选择时间，有效日，
```
对象*执行动作选项
```
选择对应设备或群组，及右侧所需执行指令，设备端目前仅支持两条以下指令。
```

